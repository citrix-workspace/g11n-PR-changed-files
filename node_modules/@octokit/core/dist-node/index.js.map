{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"2.1.2\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { Collection } from \"before-after-hook\";\nimport { request } from \"@octokit/request\";\nimport { withCustomRequest } from \"@octokit/graphql\";\nimport { createTokenAuth } from \"@octokit/auth-token\";\nimport { VERSION } from \"./version\";\nexport class Octokit {\n    constructor(options = {}) {\n        const hook = new Collection();\n        const requestDefaults = {\n            baseUrl: request.endpoint.DEFAULTS.baseUrl,\n            headers: {},\n            request: Object.assign({}, options.request, {\n                hook: hook.bind(null, \"request\")\n            }),\n            mediaType: {\n                previews: [],\n                format: \"\"\n            }\n        };\n        // prepend default user agent with `options.userAgent` if set\n        requestDefaults.headers[\"user-agent\"] = [\n            options.userAgent,\n            `octokit-core.js/${VERSION} ${getUserAgent()}`\n        ]\n            .filter(Boolean)\n            .join(\" \");\n        if (options.baseUrl) {\n            requestDefaults.baseUrl = options.baseUrl;\n        }\n        if (options.previews) {\n            requestDefaults.mediaType.previews = options.previews;\n        }\n        if (options.timeZone) {\n            requestDefaults.headers[\"time-zone\"] = options.timeZone;\n        }\n        // (1) If neither `options.authStrategy` nor `options.auth` are set, the `octokit` instance\n        //     is unauthenticated. The `this.auth()` method is a no-op and no request hook is registred.\n        // (2) If only `options.auth` is set, use the default token authentication strategy.\n        // (3) If `options.authStrategy` is set then use it and pass in `options.auth`\n        // TODO: type `options.auth` based on `options.authStrategy`.\n        if (!options.authStrategy) {\n            if (!options.auth) {\n                // (1)\n                this.auth = async () => ({\n                    type: \"unauthenticated\"\n                });\n            }\n            else {\n                // (2)\n                const auth = createTokenAuth(options.auth);\n                // @ts-ignore  ¯\\_(ツ)_/¯\n                hook.wrap(\"request\", auth.hook);\n                this.auth = auth;\n            }\n        }\n        else {\n            const auth = options.authStrategy(options.auth);\n            // @ts-ignore  ¯\\_(ツ)_/¯\n            hook.wrap(\"request\", auth.hook);\n            this.auth = auth;\n        }\n        this.request = request.defaults(requestDefaults);\n        this.graphql = withCustomRequest(this.request).defaults(requestDefaults);\n        this.log = Object.assign({\n            debug: () => { },\n            info: () => { },\n            warn: console.warn.bind(console),\n            error: console.error.bind(console)\n        }, options.log);\n        this.hook = hook;\n        // apply plugins\n        // https://stackoverflow.com/a/16345172\n        const classConstructor = this.constructor;\n        classConstructor.plugins.forEach(plugin => {\n            Object.assign(this, plugin(this, options));\n        });\n    }\n    static defaults(defaults) {\n        const OctokitWithDefaults = class extends this {\n            constructor(...args) {\n                super(Object.assign({}, defaults, args[0] || {}));\n            }\n        };\n        return OctokitWithDefaults;\n    }\n    static plugin(pluginOrPlugins) {\n        var _a;\n        const currentPlugins = this.plugins;\n        const newPlugins = Array.isArray(pluginOrPlugins)\n            ? pluginOrPlugins\n            : [pluginOrPlugins];\n        const NewOctokit = (_a = class extends this {\n            },\n            _a.plugins = currentPlugins.concat(newPlugins.filter(plugin => !currentPlugins.includes(plugin))),\n            _a);\n        return NewOctokit;\n    }\n}\nOctokit.plugins = [];\n"],"names":["VERSION","Octokit","constructor","options","hook","Collection","requestDefaults","baseUrl","request","endpoint","DEFAULTS","headers","Object","assign","bind","mediaType","previews","format","userAgent","getUserAgent","filter","Boolean","join","timeZone","authStrategy","auth","type","createTokenAuth","wrap","defaults","graphql","withCustomRequest","log","debug","info","warn","console","error","classConstructor","plugins","forEach","plugin","OctokitWithDefaults","args","pluginOrPlugins","_a","currentPlugins","newPlugins","Array","isArray","NewOctokit","concat","includes"],"mappings":"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"}