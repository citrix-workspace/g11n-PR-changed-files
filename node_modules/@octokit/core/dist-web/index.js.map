{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"2.1.2\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { Collection } from \"before-after-hook\";\nimport { request } from \"@octokit/request\";\nimport { withCustomRequest } from \"@octokit/graphql\";\nimport { createTokenAuth } from \"@octokit/auth-token\";\nimport { VERSION } from \"./version\";\nexport class Octokit {\n    constructor(options = {}) {\n        const hook = new Collection();\n        const requestDefaults = {\n            baseUrl: request.endpoint.DEFAULTS.baseUrl,\n            headers: {},\n            request: Object.assign({}, options.request, {\n                hook: hook.bind(null, \"request\")\n            }),\n            mediaType: {\n                previews: [],\n                format: \"\"\n            }\n        };\n        // prepend default user agent with `options.userAgent` if set\n        requestDefaults.headers[\"user-agent\"] = [\n            options.userAgent,\n            `octokit-core.js/${VERSION} ${getUserAgent()}`\n        ]\n            .filter(Boolean)\n            .join(\" \");\n        if (options.baseUrl) {\n            requestDefaults.baseUrl = options.baseUrl;\n        }\n        if (options.previews) {\n            requestDefaults.mediaType.previews = options.previews;\n        }\n        if (options.timeZone) {\n            requestDefaults.headers[\"time-zone\"] = options.timeZone;\n        }\n        // (1) If neither `options.authStrategy` nor `options.auth` are set, the `octokit` instance\n        //     is unauthenticated. The `this.auth()` method is a no-op and no request hook is registred.\n        // (2) If only `options.auth` is set, use the default token authentication strategy.\n        // (3) If `options.authStrategy` is set then use it and pass in `options.auth`\n        // TODO: type `options.auth` based on `options.authStrategy`.\n        if (!options.authStrategy) {\n            if (!options.auth) {\n                // (1)\n                this.auth = async () => ({\n                    type: \"unauthenticated\"\n                });\n            }\n            else {\n                // (2)\n                const auth = createTokenAuth(options.auth);\n                // @ts-ignore  ¯\\_(ツ)_/¯\n                hook.wrap(\"request\", auth.hook);\n                this.auth = auth;\n            }\n        }\n        else {\n            const auth = options.authStrategy(options.auth);\n            // @ts-ignore  ¯\\_(ツ)_/¯\n            hook.wrap(\"request\", auth.hook);\n            this.auth = auth;\n        }\n        this.request = request.defaults(requestDefaults);\n        this.graphql = withCustomRequest(this.request).defaults(requestDefaults);\n        this.log = Object.assign({\n            debug: () => { },\n            info: () => { },\n            warn: console.warn.bind(console),\n            error: console.error.bind(console)\n        }, options.log);\n        this.hook = hook;\n        // apply plugins\n        // https://stackoverflow.com/a/16345172\n        const classConstructor = this.constructor;\n        classConstructor.plugins.forEach(plugin => {\n            Object.assign(this, plugin(this, options));\n        });\n    }\n    static defaults(defaults) {\n        const OctokitWithDefaults = class extends this {\n            constructor(...args) {\n                super(Object.assign({}, defaults, args[0] || {}));\n            }\n        };\n        return OctokitWithDefaults;\n    }\n    static plugin(pluginOrPlugins) {\n        var _a;\n        const currentPlugins = this.plugins;\n        const newPlugins = Array.isArray(pluginOrPlugins)\n            ? pluginOrPlugins\n            : [pluginOrPlugins];\n        const NewOctokit = (_a = class extends this {\n            },\n            _a.plugins = currentPlugins.concat(newPlugins.filter(plugin => !currentPlugins.includes(plugin))),\n            _a);\n        return NewOctokit;\n    }\n}\nOctokit.plugins = [];\n"],"names":[],"mappings":"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"}